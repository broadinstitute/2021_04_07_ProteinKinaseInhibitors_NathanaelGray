geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= c(result[1]), color="#de2d26", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
theme_bw() + guides(color=guide_legend("Plates")) +
coord_flip() +
theme_update(plot.title = element_text(hjust = 0.5)) +
ggtitle("Replicate Correlation")
ggsave(filename='Gray_Replicate_correlation.pdf', plot = p, path = '/Users/habbasi/Desktop/')
g
View(result)
View(result)
View(result)
View(result)
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#de2d26", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
theme_bw() + guides(color=guide_legend("Plates")) +
coord_flip() +
theme_update(plot.title = element_text(hjust = 0.5)) +
ggtitle("Replicate Correlation")
ggsave(filename='Gray_Replicate_correlation.pdf', plot = g, path = '/Users/habbasi/Desktop/')
g
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#000000", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
theme_bw() + guides(color=guide_legend("Plates")) +
coord_flip() +
theme_update(plot.title = element_text(hjust = 0.5)) +
ggtitle("Replicate Correlation")
ggsave(filename='Gray_Replicate_correlation.pdf', plot = g, path = '/Users/habbasi/Desktop/')
g
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
theme_classic() + guides(color=guide_legend("Plates")) +
coord_flip() +
theme_update(plot.title = element_text(hjust = 0.5)) +
ggtitle("Replicate Correlation")
ggsave(filename='Gray_Replicate_correlation.pdf', plot = g, path = '/Users/habbasi/Desktop/')
g
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
theme_light() + guides(color=guide_legend("Plates")) +
coord_flip() +
theme_update(plot.title = element_text(hjust = 0.5)) +
ggtitle("Replicate Correlation")
ggsave(filename='Gray_Replicate_correlation.pdf', plot = g, path = '/Users/habbasi/Desktop/')
g
# Plotting
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
theme_light() +
theme_update(plot.title = element_text(hjust = 0.5)) +
ggtitle("Replicate Correlation")
ggsave(filename='Gray_Replicate_correlation.pdf', plot = g, path = '/Users/habbasi/Desktop/')
g
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
theme_void() +
theme_update(plot.title = element_text(hjust = 0.5)) +
ggtitle("Replicate Correlation")
ggsave(filename='Gray_Replicate_correlation.pdf', plot = g, path = '/Users/habbasi/Desktop/')
g
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
theme_update(plot.title = element_text(hjust = 0.5)) +
ggtitle("Replicate Correlation")
g + theme_classic()
ggsave(filename='Gray_Replicate_correlation.pdf', plot = g, path = '/Users/habbasi/Desktop/')
g
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
theme_light() +
theme_update(plot.title = element_text(hjust = 0.5)) +
ggtitle("Replicate Correlation")
ggsave(filename='Gray_Replicate_correlation.pdf', plot = g, path = '/Users/habbasi/Desktop/')
g
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
theme_update(plot.title = element_text(hjust = 0.5)) +
ggtitle("Replicate Correlation")
p <- g + theme_classic()
ggsave(filename='Gray_Replicate_correlation.pdf', plot = p, path = '/Users/habbasi/Desktop/')
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
theme_update(plot.title = element_text(hjust = 0.5)) +
ggtitle("Replicate Correlation")
p <- g + theme_classic()
ggsave(filename='Gray_Replicate_correlation.pdf', plot = p, path = '/Users/habbasi/Desktop/')
p
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
theme_update(plot.title = element_text(yjust = 0.5)) +
ggtitle("Replicate Correlation")
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
theme_update(plot.title = element_text(hjust = 1)) +
ggtitle("Replicate Correlation")
p <- g + theme_classic()
ggsave(filename='Gray_Replicate_correlation.pdf', plot = p, path = '/Users/habbasi/Desktop/')
p
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
theme_update(plot.title = element_text(hjust = 0.2)) +
ggtitle("Median Replicate Correlation")
p <- g + theme_classic()
ggsave(filename='Gray_Replicate_correlation.pdf', plot = p, path = '/Users/habbasi/Desktop/')
p
setwd("/Users/habbasi/Documents/Broad/Broad_collaborative_projects\ /Broad_profiling_projects/050919_Nathianel_Gray/Scripts")
f.path <- "../collated/C-7210-01-CMP-008-gray_collapsed_sampled.csv"
out.path <- "../Figures_new/"
# REading files
df <- data.frame(readr::read_csv(f.path), stringsAsFactors =F)
# Metadata variables
metadata <-
colnames(df) %>%
stringr::str_subset("^Metadata_")
# Variables(Cell/Nuclei/Cytoplasm)
variables <-
colnames(df) %>%
stringr::str_subset("^Nuclei_|^Cells_|^Cytoplasm_")
# Function Calculating Median Pairwise Correlation
median_pairwise_correlation <- function(df, variables, group_by) {
df %>%
dplyr::group_by_(.dots = group_by) %>%
do(tibble::data_frame(correlation = median(as.dist(cor(t(as.matrix(.[variables])))))))
}
set.seed(24)
correlations <- df %>%
median_pairwise_correlation(variables, group_by = c("Metadata_Plate", "Metadata_compound_name"))
c <- correlations %>%
group_by(Metadata_compound_name) %>%
arrange(desc(correlation))
# Calculation of Null threshold
null_threshold <-
1:10 %>%
map_df(function(i) {
df %>%
tidyr::unite_("group_by", "Metadata_compound_name") %>%
mutate(group_by = sample(group_by)) %>%
median_pairwise_correlation(variables, "group_by")
}) %>%
magrittr::extract2("correlation") %>%
quantile(0.95, na.rm = TRUE)
result <-
tibble::data_frame(
null_threshold = null_threshold,
fraction_strong = (sum(correlations$correlation > null_threshold) / nrow(correlations))
)
# Plotting
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
theme_update(plot.title = element_text(hjust = 0.2)) +
ggtitle("Median Replicate Correlation")
p <- g + theme_classic()
ggsave(filename='Gray_Replicate_correlation.pdf', plot = p, path = out.path)
p
p <- ggplot(c_median, aes(x=c_median$Metadata_compound_name, y=c_median$correlation)) +
geom_bar(stat = "identity") +
coord_flip() +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
theme(plot.title = element_text(hjust = 0.5)) +
ggtitle("Median Replicate Correlation")
ggsave(filename='Gray_Median_Replicate_correlation.pdf', plot = p, path = '/Users/habbasi/Desktop/')
p
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
theme(plot.title = element_text(hjust = 0.5)) +
ggtitle("Median Replicate Correlation")
p <- g + theme_classic()
ggsave(filename='Gray_Replicate_correlation.pdf', plot = p, path = out.path)
p
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
ggtitle("Median Replicate Correlation")
p <- g + theme_classic() + theme(plot.title = element_text(hjust = 0.5))
ggsave(filename='Gray_Replicate_correlation.pdf', plot = p, path = out.path)
p
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
ggtitle("Median Replicate Correlation")
p <- g + theme_classic() + theme(plot.title = element_text(hjust = 0.5))
ggsave(filename='Gray_Replicate_correlation.png', plot = p, path = out.path)
p
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
ggtitle("Median Replicate Correlation")
p <- g + theme_classic() + theme(plot.title = element_text(hjust = 0.5))
ggsave(filename='Gray_Replicate_correlation.pdf', plot = p, path = out.path)
p
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
ggtitle("Median Replicate Correlation")
p <- g + theme_classic() + theme(plot.title = element_text(hjust = 0.5)) + + theme(legend.key = element_rect(fill = "gray"))
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
ggtitle("Median Replicate Correlation")
p <- g + theme_classic() + theme(plot.title = element_text(hjust = 0.5)) + theme(legend.key = element_rect(fill = "gray"))
ggsave(filename='Gray_Replicate_correlation.pdf', plot = p, path = out.path)
p
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
ggtitle("Median Replicate Correlation")
p <- g + theme_classic() + theme(plot.title = element_text(hjust = 0.5)) + theme(legend.key = element_rect(fill = "white"))
ggsave(filename='Gray_Replicate_correlation.pdf', plot = p, path = out.path)
p
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
ggtitle("Median Replicate Correlation")
p <- g + theme_classic() + theme(plot.title = element_text(hjust = 0.5)) + theme(legend.key = element_rect(fill = "white")) + plot.background = element_rect(colour = "white")
# Plotting
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
ggtitle("Median Replicate Correlation")
p <- g + theme_classic() + theme(plot.title = element_text(hjust = 0.5),
legend.key = element_rect(fill = "white"))
ggsave(filename='Gray_Replicate_correlation.pdf', plot = p, path = out.path)
p
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
ggtitle("Median Replicate Correlation")
p <- g + theme_classic() + theme(plot.title = element_text(hjust = 0.5),
legend.key = element_rect(fill = "white"),
plot.background = element_rect(colour = "white"))
ggsave(filename='Gray_Replicate_correlation.pdf', plot = p, path = out.path)
p
p <- g + theme_classic() + theme(plot.title = element_text(hjust = 0.5),
legend.key = element_rect(fill = "white"),
plot.background = element_rect(fill = "white"))
ggsave(filename='Gray_Replicate_correlation.pdf', plot = p, path = out.path)
p
p <- g + theme_classic() + theme(plot.title = element_text(hjust = 0.5),
legend.key = element_rect(fill = "white"),
plot.background = element_rect(fill = "gray"))
ggsave(filename='Gray_Replicate_correlation.pdf', plot = p, path = out.path)
p
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
ggtitle("Median Replicate Correlation")
p <- g + theme_classic() + theme(plot.title = element_text(hjust = 0.5),
legend.key = element_rect(fill = "white"),
plot.title = element_textbox(hjust = 0.5, margin = margin(t = 5, b = 5))
)
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
ggtitle("Median Replicate Correlation")
p <- g + theme_classic() + theme(
legend.key = element_rect(fill = "white"),
plot.title = element_textbox(hjust = 0.5, margin = margin(t = 5, b = 5))
)
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
ggtitle("Median Replicate Correlation")
p <- g + theme_classic() + theme(
legend.key = element_rect(fill = "white"),
plot.title = element_text(hjust = 0.5, margin = margin(t = 5, b = 5))
)
ggsave(filename='Gray_Replicate_correlation.pdf', plot = p, path = out.path)
p
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
ggtitle("Median Replicate Correlation")
p <- g + theme_classic() + theme(
legend.key = element_rect(fill = "white"),
plot.title = element_text(hjust = 0.5, element.text(hjust = 0.5, size = 20,
color = "#FFFFFF"))
)
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
ggtitle("Median Replicate Correlation")
p <- g + theme_classic() + theme(
legend.key = element_rect(fill = "white"),
plot.title = element_text(hjust = 0.5,  size = 20, color = "#FFFFFF")
)
ggsave(filename='Gray_Replicate_correlation.pdf', plot = p, path = out.path)
p
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
ggtitle("Median Replicate Correlation")
p <- g + theme_classic() + theme(
legend.key = element_rect(fill = "white"),
plot.title = element_text(hjust = 0.5, margin = margin(t = 5, b = 5), color="#FFFFFF")
)
ggsave(filename='Gray_Replicate_correlation.pdf', plot = p, path = out.path)
p
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
ggtitle("Median Replicate Correlation")
p <- g + theme_classic() + theme(
legend.key = element_rect(fill = "white"),
plot.title = element_text(hjust = 0.5, margin = margin(t = 5, b = 5))
)
ggsave(filename='Gray_Replicate_correlation.pdf', plot = p, path = out.path)
p
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
ggtitle("Median Replicate Correlation")
p <- g + theme_classic() + theme(
legend.key = element_rect(fill = "white"),
plot.title = element_text(hjust = 0.5, margin = margin(t = 5, b = 5)),
strip.background = element_rect(fill="#228b22"),
strip.text = element_text(size=15, colour="white")
)
ggsave(filename='Gray_Replicate_correlation.pdf', plot = p, path = out.path)
p
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
ggtitle("Median Replicate Correlation")
p <- g + theme_classic() + theme(
legend.key = element_rect(fill = "white"),
plot.title = element_text(hjust = 0.5),
strip.background = element_rect(fill="#228b22"),
strip.text = element_text(size=15, colour="white")
)
ggsave(filename='Gray_Replicate_correlation.pdf', plot = p, path = out.path)
p
g <- ggplot(c, aes(x=c$Metadata_compound_name, y=c$correlation)) +
geom_line(aes(group = c$Metadata_compound_name )) +
geom_point(aes(color = c$Metadata_Plate)) +
geom_hline(yintercept= 	0.1059162, color="#006d2c", linetype="dotted", size=1) +
labs(x = "Protein Kinase Inhibitors", y= "Correlations") +
guides(color=guide_legend("Plates")) +
coord_flip() +
ggtitle("Median Replicate Correlation")
p <- g + theme_classic() + theme_bw()+
theme(strip.background =element_rect(fill="red"))+
theme(strip.text = element_text(colour = 'white')) + theme(
legend.key = element_rect(fill = "white"),
plot.title = element_text(hjust = 0.5)
)
ggsave(filename='Gray_Replicate_correlation.pdf', plot = p, path = out.path)
p
setwd("/Users/habbasi/Documents/Broad/Broad_collaborative_projects\ /Broad_profiling_projects/050919_Nathianel_Gray/Scripts")
f.path <- "../collated/C-7210-01-CMP-008-gray_collapsed_sampled.csv"
out.path <- "../Figures_new/"
# REading files
df <- data.frame(readr::read_csv(f.path), stringsAsFactors =F)
# Metadata variables
metadata <-
colnames(df) %>%
stringr::str_subset("^Metadata_")
# Variables(Cell/Nuclei/Cytoplasm)
variables <-
colnames(df) %>%
stringr::str_subset("^Nuclei_|^Cells_|^Cytoplasm_")
# Function Calculating Median Pairwise Correlation
median_pairwise_correlation <- function(df, variables, group_by) {
df %>%
dplyr::group_by_(.dots = group_by) %>%
do(tibble::data_frame(correlation = median(as.dist(cor(t(as.matrix(.[variables])))))))
}
set.seed(24)
correlations <- df %>%
median_pairwise_correlation(variables, group_by = c("Metadata_Plate", "Metadata_Well"))
c <- correlations %>%
group_by(Metadata_compound_name) %>%
arrange(desc(correlation))
